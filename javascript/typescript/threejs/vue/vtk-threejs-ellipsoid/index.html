<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.21.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Setting up the Three.js ellipsoids - Parresia Simulations</title>
<meta name="description" content="Javascript scientific visualization - Part 6">


  <meta name="author" content="Biswajit Banerjee">
  
  <meta property="article:author" content="Biswajit Banerjee">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Parresia Simulations">
<meta property="og:title" content="Setting up the Three.js ellipsoids">
<meta property="og:url" content="https://bbanerjee.github.io/ParSim/javascript/typescript/threejs/vue/vtk-threejs-ellipsoid/">


  <meta property="og:description" content="Javascript scientific visualization - Part 6">







  <meta property="article:published_time" content="2017-03-01T23:30:00+13:00">





  

  


<link rel="canonical" href="https://bbanerjee.github.io/ParSim/javascript/typescript/threejs/vue/vtk-threejs-ellipsoid/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Biswajit Banerjee",
      "url": "https://bbanerjee.github.io/ParSim/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/ParSim/feed.xml" type="application/atom+xml" rel="alternate" title="Parresia Simulations Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/ParSim/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<link rel="stylesheet" href="https://bbanerjee.github.io/ParSim/assets/css/parresia.css">

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_HTMLorMML">
  </script>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/ParSim/"><img src="/ParSim/assets/img/ParresiaLogoSep2017_plain.png" alt=""></a>
        
        <a class="site-title" href="/ParSim/">
          Parresia Simulations
          <span class="site-subtitle">Parallel particle and finite element simulation</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/ParSim/docs/articles/">Blog articles</a>
            </li><li class="masthead__menu-item">
              <a href="/ParSim/docs/parsim/">ParSim software</a>
            </li><li class="masthead__menu-item">
              <a href="/ParSim/docs/material-data/">Material data</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Biswajit Banerjee</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>PhD Mechanical Engineering</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Auckland, NZ</span>
        </li>
      

      
        
          
            <li><a href="mailto:b.banerjee.nz@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Setting up the Three.js ellipsoids">
    <meta itemprop="description" content="IntroductionIn the previous articles in this series we talked about:">
    <meta itemprop="datePublished" content="2017-03-01T23:30:00+13:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Setting up the Three.js ellipsoids
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          13 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h5 id="introduction">Introduction</h5>
<p>In the previous articles in this series we talked about:</p>

<ol>
  <li><a href="/ParSim/javascript/typescript/vue/vuex/xml/reading-vtk-particles/">Part 1: Reading VTK format particles with Javascript in a browser</a></li>
  <li><a href="/ParSim/javascript/typescript/vue/vuex/vuex-store/">Part 2: Saving the read-in particle data in a Vuex store</a></li>
  <li><a href="/ParSim/javascript/typescript/threejs/vue/vtk-threejs/">Part 3: Initialization of a store and the user interface</a>.</li>
  <li><a href="/ParSim/javascript/typescript/threejs/vue/vtk-threejs-renderer/">Part 4: Setting up the Three.js renderer</a></li>
  <li><a href="/ParSim/javascript/typescript/threejs/vue/vtk-threejs-camera/">Part 5: Setting up the Three.js scene and camera</a>
<!--more--></li>
</ol>

<p>We are now ready to discuss the <code class="language-plaintext highlighter-rouge">three-ellipsoid-particles</code> component that we introduced in 
<code class="language-plaintext highlighter-rouge">ThreeGraphicsPanel.vue</code>.  Recall that the template has the following form:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;template&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">'three-graphics-container'</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"uk-card uk-card-default uk-card-large"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"uk-card-body"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;three-renderer</span> <span class="na">v-bind:size=</span><span class="s">"{w:500, h:500}"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;three-scene</span> <span class="na">v-bind:size=</span><span class="s">"size"</span><span class="nt">&gt;</span> 
            <span class="nt">&lt;three-camera</span> <span class="na">v-bind:size=</span><span class="s">"size"</span> <span class="na">v-bind:position=</span><span class="s">"{x: 100,  z: 15 }"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/three-camera&gt;</span>
            <span class="nt">&lt;three-ellipsoid-particles&gt;</span> <span class="nt">&lt;/three-ellipsoid-particles&gt;</span>
          <span class="nt">&lt;/three-scene&gt;</span>
        <span class="nt">&lt;/three-renderer&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/template&gt;</span></code></pre></figure>

<h5 id="the-ellipsoid-particles-component">The ellipsoid particles component</h5>
<p>The file <code class="language-plaintext highlighter-rouge">ThreeEllipsoidParticles.vue</code> also does not contain any information inside the
<code class="language-plaintext highlighter-rouge">&lt;template&gt;</code> tags and contains the following:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;template&gt;</span> <span class="nt">&lt;/template&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"./ThreeEllipsoidParticles.ts"</span><span class="nt">&gt;</span> <span class="nt">&lt;/script&gt;</span></code></pre></figure>

<p>However, the source code contains more - as you can see below.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js"><span class="k">import</span> <span class="o">*</span> <span class="k">as</span> <span class="nx">Vue</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">vue</span><span class="dl">"</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Lifecycle</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">av-ts</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">THREE</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">three</span><span class="dl">"</span><span class="p">);</span>
<span class="k">import</span> <span class="nx">Store</span> <span class="k">from</span> <span class="dl">"</span><span class="s2">./Store</span><span class="dl">"</span><span class="p">;</span>
<span class="p">@</span><span class="nd">Component</span><span class="p">({</span>
  <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ThreeEllipsoidParticles</span><span class="dl">'</span>
<span class="p">})</span>
<span class="k">export</span> <span class="k">default</span> <span class="kd">class</span> <span class="nx">ThreeEllipsoidParticles</span> <span class="kd">extends</span> <span class="nx">Vue</span> <span class="p">{</span>
  <span class="p">@</span><span class="nd">Lifecycle</span>
  <span class="kr">public</span> <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Create a watch in the store to make sure the particle</span>
    <span class="c1">// file has been read before particles are created</span>
    <span class="kd">var</span> <span class="nb">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">Store</span><span class="p">.</span><span class="nx">watch</span><span class="p">(</span>
      <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">Store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">particleReadComplete</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">Store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">particleReadComplete</span><span class="p">)</span>
          <span class="nb">self</span><span class="p">.</span><span class="nx">createThreeParticles</span><span class="p">();</span>
      <span class="p">});</span>
  <span class="p">}</span>
  <span class="c1">// Actually create the particles</span>
  <span class="kr">private</span> <span class="nx">createThreeParticles</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">.....</span> <span class="nx">see</span> <span class="nx">below</span> <span class="p">....</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>There are several aspects that need consideration in this code.</p>

<p class="notice">We use the <code class="language-plaintext highlighter-rouge">watch</code> “instance method” of <a href="https://vuex.vuejs.org/en/api.html">Vuex</a> to make sure that
the particles are added to the scene only after the particle file has been read.</p>

<p class="notice--warning">In this example
we do not stop watching the variable <code class="language-plaintext highlighter-rouge">particleReadComplete</code> (see <a href="/ParSim/javascript/typescript/vue/vuex/vuex-store/">Part 2</a> for details) after the particle data has been converted and saved.  However, that step is highly recommended.</p>

<h5 id="creating-the-ellipsoid-particles">Creating the ellipsoid particles</h5>
<p>The particle axis data are in the form of angles between the ellipsoid axes and the world coordinate axes.
These are converted directly into the appropriate rotation matrix.  Sphere objects are then created at
the origin, rotated, scaled, and translated to their actual positions.  The sphere objects are then
transformed into <code class="language-plaintext highlighter-rouge">SphereBufferGeometry</code> objects to make their manipulation slightly more efficient.
Finally, a “material” shading model is added to make sure that the image displayed isn’t flat and
a triangulated mesh is generated for each object.</p>

<figure class="highlight"><pre><code class="language-js" data-lang="js">  <span class="kr">private</span> <span class="nx">createThreeParticles</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Get the particle data</span>
    <span class="kd">let</span> <span class="nx">particles</span> <span class="o">=</span> <span class="nx">Store</span><span class="p">.</span><span class="nx">getters</span><span class="p">.</span><span class="nx">particleData</span><span class="p">;</span>
    <span class="c1">// Extract the radius and center</span>
    <span class="kd">let</span> <span class="nx">radii</span> <span class="o">=</span> <span class="nx">particles</span><span class="p">[</span><span class="dl">"</span><span class="s2">Radius</span><span class="dl">"</span><span class="p">];</span>
    <span class="kd">let</span> <span class="nx">centers</span> <span class="o">=</span> <span class="nx">particles</span><span class="p">[</span><span class="dl">"</span><span class="s2">Position</span><span class="dl">"</span><span class="p">];</span>
    <span class="kd">let</span> <span class="nx">axes_a</span> <span class="o">=</span> <span class="nx">particles</span><span class="p">[</span><span class="dl">"</span><span class="s2">Axis a</span><span class="dl">"</span><span class="p">];</span>
    <span class="kd">let</span> <span class="nx">axes_b</span> <span class="o">=</span> <span class="nx">particles</span><span class="p">[</span><span class="dl">"</span><span class="s2">Axis b</span><span class="dl">"</span><span class="p">];</span>
    <span class="kd">let</span> <span class="nx">axes_c</span> <span class="o">=</span> <span class="nx">particles</span><span class="p">[</span><span class="dl">"</span><span class="s2">Axis c</span><span class="dl">"</span><span class="p">];</span>
    <span class="c1">// Loop through particles</span>
    <span class="kd">var</span> <span class="nb">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">radii</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">radius</span><span class="p">:</span> <span class="nx">any</span><span class="p">,</span> <span class="nx">index</span><span class="p">:</span> <span class="nx">number</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Get the radius ratios</span>
      <span class="kd">let</span> <span class="nx">ratio</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="nx">radius</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="nx">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">radius</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="nx">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
      <span class="c1">// Get the axes into vectors and compute rotation matrix</span>
      <span class="kd">let</span> <span class="nx">axis_a</span> <span class="o">=</span> 
        <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">axes_a</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> 
                          <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">axes_a</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> 
                          <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">axes_a</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]));</span>
      <span class="kd">let</span> <span class="nx">axis_b</span> <span class="o">=</span> 
        <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">axes_b</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> 
                          <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">axes_b</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> 
                          <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">axes_b</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]));</span>
      <span class="kd">let</span> <span class="nx">axis_c</span> <span class="o">=</span> 
        <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">axes_c</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span> 
                          <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">axes_c</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> 
                          <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">axes_c</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]));</span>
      <span class="kd">let</span> <span class="nx">rotMatrix</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Matrix4</span><span class="p">();</span>
      <span class="nx">rotMatrix</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span>
        <span class="nx">axis_a</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">axis_b</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">axis_c</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">axis_a</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">axis_b</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">axis_c</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">axis_a</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">axis_b</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="nx">axis_c</span><span class="p">.</span><span class="nx">z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span>
        <span class="p">);</span>
      <span class="c1">// Create the sphere geometry</span>
      <span class="kd">const</span> <span class="nx">sph_geometry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SphereGeometry</span><span class="p">(</span><span class="nx">radius</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
      <span class="c1">// Rotate sphere </span>
      <span class="nx">sph_geometry</span><span class="p">.</span><span class="nx">applyMatrix</span><span class="p">(</span><span class="nx">rotMatrix</span><span class="p">);</span>
      <span class="c1">// Convert into ellipsoid</span>
      <span class="nx">sph_geometry</span><span class="p">.</span><span class="nx">applyMatrix</span><span class="p">(</span><span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Matrix4</span><span class="p">().</span><span class="nx">makeScale</span><span class="p">(</span><span class="nx">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">ratio</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
      <span class="c1">// Translate the geometry</span>
      <span class="kd">let</span> <span class="nx">center</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Vector3</span><span class="p">(</span><span class="nx">centers</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nx">centers</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nx">centers</span><span class="p">[</span><span class="nx">index</span><span class="p">][</span><span class="mi">2</span><span class="p">]);</span>
      <span class="nx">sph_geometry</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">center</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">center</span><span class="p">.</span><span class="nx">y</span><span class="p">,</span> <span class="nx">center</span><span class="p">.</span><span class="nx">z</span><span class="p">);</span>
      <span class="c1">// Convert into buffer geometry</span>
      <span class="kd">const</span> <span class="nx">geometry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">BufferGeometry</span><span class="p">().</span><span class="nx">fromGeometry</span><span class="p">(</span><span class="nx">sph_geometry</span><span class="p">);</span>
      <span class="c1">// Create the material for display purposes</span>
      <span class="kd">const</span> <span class="nx">material</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">MeshPhongMaterial</span><span class="p">({</span>
        <span class="na">color</span><span class="p">:</span> <span class="mh">0xffaa00</span><span class="p">,</span>
        <span class="na">emissive</span><span class="p">:</span> <span class="mh">0x072534</span><span class="p">,</span>
        <span class="na">side</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">DoubleSide</span><span class="p">,</span>
        <span class="na">shading</span><span class="p">:</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">SmoothShading</span><span class="p">,</span>
        <span class="na">wireframe</span><span class="p">:</span> <span class="kc">false</span>
      <span class="p">});</span>
      <span class="c1">// Create the mesh</span>
      <span class="kd">const</span> <span class="nx">sphere</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">THREE</span><span class="p">.</span><span class="nx">Mesh</span><span class="p">(</span><span class="nx">geometry</span><span class="p">,</span> <span class="nx">material</span><span class="p">);</span>
      <span class="c1">// Save the data</span>
      <span class="nx">Store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">'</span><span class="s1">ADD_THREE_OBJECT</span><span class="dl">'</span><span class="p">,</span> <span class="nx">sphere</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">Store</span><span class="p">.</span><span class="nx">commit</span><span class="p">(</span><span class="dl">'</span><span class="s1">THREE_OBJECTS_CREATED</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
  <span class="p">}</span></code></pre></figure>

<p class="notice--info">The rotation matrix performs a transformation of the form
\(\hat{\mathbf{w}} = \boldsymbol{R} \cdot \mathbf{w}\,.\)
We want to rotate the world coordinate vectors
\(\mathbf{E}_1\), \(\mathbf{E}_2\), \(\mathbf{E}_3\), 
into vectors that are aligned with the ellipsoid axes,
\(\mathbf{e}_1\), \(\mathbf{e}_2\), \(\mathbf{e}_3\). 
Therefore, we need to find a rotation matrix \(\boldsymbol{R}\)
such that \(\mathbf{e}_\alpha = \boldsymbol{R}\cdot\mathbf{E}_\alpha\)
where \(\alpha = 1,2,3\). Taking dot products of both sides with
\(\mathbf{E}_\beta\), we get
\(\mathbf{E}_\beta\cdot\mathbf{e}_\alpha =
\mathbf{E}_\beta\cdot\boldsymbol{R}\cdot\mathbf{E}_\alpha = 
(\mathbf{E}_\beta\otimes\mathbf{E}_\alpha):\boldsymbol{R} \,.\) Now, \(\boldsymbol{R} = R_{mn} \mathbf{E}_m \otimes \mathbf{E}_n\).
So we have
\(\mathbf{E}_\beta\cdot\mathbf{e}_\alpha =
  R_{mn} (\mathbf{E}_\beta\otimes\mathbf{E}_\alpha): (\mathbf{E}_m \otimes \mathbf{E}_n)
  = R_{mn} (\mathbf{E}_\beta\cdot\mathbf{E}_m) (\mathbf{E}_\alpha \cdot \mathbf{E}_n)
  = R_{mn} \delta_{\beta m} \delta_{\alpha n}\).
Therefore, \(\mathbf{E}_\beta\cdot\mathbf{e}_\alpha = R_{\beta\alpha}\).</p>

<p>Let us look at the ellipsoid axis vector \(\mathbf{e}_1 = \mathbf{e}_a\).  This vector has
components \((e_{11}, e_{12}, e_{13})\) where \(e_{11} = \mathbf{e}_1 \cdot \mathbf{E}_1 = R_{11}\),
\(e_{12} = \mathbf{e}_1 \cdot \mathbf{E}_2 = R_{21}\), and \(e_{13} = \mathbf{e}_1 \cdot \mathbf{E}_3 = R_{31}\).  That is why we can create the rotation matrix directly from the axis data in
the code sample.</p>

<h4 id="remarks">Remarks</h4>
<p>A plot of the ellipsoids produced by our code can be seen below.</p>

<p><img src="/ParSim/assets/blogimg/ThreeGraphicsPanel.jpg" alt="Plot produced by Three.js" class="img-responsive center-image" height="450px" border="5px double red" /></p>

<p>In the next part of this series we will explore how <code class="language-plaintext highlighter-rouge">vtk.js</code> can be used to do the same plot.</p>


        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/ParSim/categories/#javascript" class="page__taxonomy-item" rel="tag">Javascript</a><span class="sep">, </span>
    
      
      
      <a href="/ParSim/categories/#threejs" class="page__taxonomy-item" rel="tag">Threejs</a><span class="sep">, </span>
    
      
      
      <a href="/ParSim/categories/#typescript" class="page__taxonomy-item" rel="tag">Typescript</a><span class="sep">, </span>
    
      
      
      <a href="/ParSim/categories/#vue" class="page__taxonomy-item" rel="tag">Vue</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2017-03-01T23:30:00+13:00">March 1, 2017</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Setting+up+the+Three.js+ellipsoids%20https%3A%2F%2Fbbanerjee.github.io%2FParSim%2Fjavascript%2Ftypescript%2Fthreejs%2Fvue%2Fvtk-threejs-ellipsoid%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fbbanerjee.github.io%2FParSim%2Fjavascript%2Ftypescript%2Fthreejs%2Fvue%2Fvtk-threejs-ellipsoid%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fbbanerjee.github.io%2FParSim%2Fjavascript%2Ftypescript%2Fthreejs%2Fvue%2Fvtk-threejs-ellipsoid%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/ParSim/javascript/typescript/threejs/vue/vtk-threejs-camera/" class="pagination--pager" title="Setting up the Three.js scene and camera
">Previous</a>
    
    
      <a href="/ParSim/javascript/typescript/vtkjs/threejs/vue/vtkjs-ellipsoid/" class="pagination--pager" title="Plotting particles with vtk.js
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ParSim/fem/meshing/gmsh/gmsh-meshing-for-code-aster/" rel="permalink">Meshes with different element topologies in gmsh (for Code-Aster)
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          39 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">We have been translating a few Code-Aster verification test manuals into English.
The process is not just a straightforward translation of the text in the Fr...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ParSim/fem/meshing/gmsh/quadrlateral-meshing-with-gmsh/" rel="permalink">Creating quadrilateral surface meshes with gmsh
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          21 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">The Code-Aster cooling tower modal analysis validation test
FORMA11c comes with a quadrilateral mesh provided by Code-Aster.
Tips on quadrilateral meshing wi...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ParSim/fem/cracks/python/salome-meca/code-aster/inspecting-and-manipulating-meshes/" rel="permalink">Inspecting and manipulating meshes in Salome-Meca for Code-Aster
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          30 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">In this article, I will discuss how elements can be selected from deep inside a 3D mesh
in the Salome-Meca environment and manipulated with Python scripts.

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ParSim/vaango/compiling-vaango-on-a-cray/" rel="permalink">Compiling and running the MPM code Vaango on a Cray
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          16 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Introduction

One of the reasons I switched to cmake for my builds was the need to compile my
Vaango code on a BlueGene/Q system.  The code was previously co...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
    

    <li><a href="/ParSim/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Biswajit Banerjee. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/ParSim/assets/js/main.min.js"></script>










  </body>
</html>
